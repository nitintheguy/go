<ion-header [translucent]="true">
  <ion-toolbar class="custom-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1" text="" class="custom-back-button"></ion-back-button>
    </ion-buttons>
    <ion-title class="page-title">{{ categoryName }}</ion-title>
    <ion-buttons slot="end">
      <ion-button fill="clear" class="header-btn">
        <ion-icon name="search-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" class="header-btn cart-btn">
        <ion-icon name="cart-outline" slot="icon-only"></ion-icon>
        <ion-badge color="danger" class="cart-badge">3</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Integrated Category Info in Header -->
  <div class="header-content">
    <div class="category-meta">
      <div class="category-stats">
        <div class="stat">
          <ion-icon name="storefront-outline" class="stat-icon"></ion-icon>
          <span>{{ items.length }}+ Products</span>
        </div>
        <div class="stat">
          <ion-icon name="time-outline" class="stat-icon"></ion-icon>
          <span>15-30 min</span>
        </div>
        <div class="stat">
          <ion-icon name="star" class="stat-icon"></ion-icon>
          <span>4.5+ Rating</span>
        </div>
      </div>
      <p class="category-description">Fresh products delivered to your doorstep</p>
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" class="category-content">
  <!-- Enhanced Filters Section -->
  <div class="filters-container">
    <div class="filters-header">
      <h3>Filter & Sort</h3>
      <button class="clear-filters" (click)="clearFilters()">
        Clear All
      </button>
    </div>
    
    <div class="filters-scroll">
      <button *ngFor="let filter of filters" 
              class="filter-chip" 
              [class.active]="filter.active"
              (click)="toggleFilter(filter)">
        {{ filter.name }}
        <ion-icon *ngIf="filter.icon" [name]="filter.icon"></ion-icon>
      </button>
    </div>

    <div class="sort-options">
      <button class="sort-btn" (click)="openSortModal()">
        <ion-icon name="filter-outline"></ion-icon>
        Sort: {{ getCurrentSortText() }}
        <ion-icon name="chevron-down" class="chevron"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-section">
    <div class="section-header">
      <h2>Featured Products</h2>
      <div class="results-count">{{ filteredItems.length }} items</div>
    </div>

    <div class="products-grid">
      <div *ngFor="let item of filteredItems" class="product-card" (click)="viewItem(item)">
        <!-- Product Badges -->
        <div class="card-badges">
          <div class="badge discount" *ngIf="item.discount">-{{item.discount}}% OFF</div>
          <div class="badge bestseller" *ngIf="item.isBestseller">ðŸ”¥ Bestseller</div>
          <button class="favorite-btn" (click)="toggleFavorite(item, $event)" [class.favorited]="item.isFavorite">
            <ion-icon [name]="item.isFavorite ? 'heart' : 'heart-outline'"></ion-icon>
          </button>
        </div>

        <!-- Product Image -->
        <div class="product-image-container">
          <img [src]="item.image" [alt]="item.name" class="product-image" />
        </div>

        <!-- Product Info -->
        <div class="product-info">
          <div class="product-header">
            <h3 class="product-name">{{ item.name }}</h3>
            <div class="product-rating">
              <ion-icon name="star" class="rating-star"></ion-icon>
              <span class="rating-value">{{ item.rating }}</span>
              <span class="rating-count">({{ item.ratingCount }})</span>
            </div>
          </div>

          <p class="product-weight">{{ item.weight }}</p>

          <div class="product-price">
            <span class="current-price">{{ item.price }}</span>
            <span class="original-price" *ngIf="item.originalPrice">{{ item.originalPrice }}</span>
          </div>

          <!-- Product Features -->
          <div class="product-features">
            <span class="feature" *ngIf="item.isExpress">
              <ion-icon name="flash-outline"></ion-icon>
              Express
            </span>
            <span class="feature" *ngIf="item.isFresh">
              <ion-icon name="leaf-outline"></ion-icon>
              Fresh
            </span>
          </div>
        </div>

        <!-- Add to Cart Button -->
        <button class="add-to-cart-btn" (click)="addToCart(item, $event)">
          <ion-icon name="add" class="add-icon"></ion-icon>
          Add to Cart
        </button>
      </div>
    </div>
  </div>

  <!-- Load More Section -->
  <div class="load-more-section" *ngIf="hasMoreItems">
    <ion-button expand="block" fill="clear" class="load-more-btn" (click)="loadMoreItems()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Load More Products
    </ion-button>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="filteredItems.length === 0">
    <div class="empty-illustration">
      <ion-icon name="search-outline"></ion-icon>
    </div>
    <h3>No products found</h3>
    <p>Try adjusting your filters or search terms</p>
    <ion-button fill="solid" (click)="clearFilters()">
      Clear All Filters
    </ion-button>
  </div>
</ion-content>